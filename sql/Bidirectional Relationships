WITH latest_hr_batch AS (
  SELECT MAX(batch_seq) AS batch_seq
  FROM   dq_cleanse_results
  WHERE  domain_name = 'HR'
),
anchors AS (
  SELECT pcr.*
  FROM   dq_per_contact_relationships_v pcr
  WHERE EXISTS (
          SELECT 1
          FROM   dq_cleanse_results r
                 JOIN latest_hr_batch b ON b.batch_seq = r.batch_seq
          WHERE  r.procedure_name = 'DQ_EXISTS'
            AND  r.field_name     = 'DQ_PERSON_ID'
            AND  r.domain_name    = 'HR'
            AND  r.start_value    = TO_CHAR(pcr.person_id)  -- or TO_CHAR(pcr.dq_person_id)
       )
)
SELECT
  a.person_id            AS a_person_id,
  a.contact_person_id    AS a_contact_person_id,
  a.contact_type         AS a_contact_type,
  a.date_start           AS a_date_start,
  a.date_end             AS a_date_end,
  r.person_id            AS r_person_id,
  r.contact_person_id    AS r_contact_person_id,
  r.contact_type         AS r_contact_type,
  r.date_start           AS r_date_start,
  r.date_end             AS r_date_end
FROM anchors a
JOIN dq_per_contact_relationships_v r
  ON r.person_id         = a.contact_person_id
 AND r.contact_person_id = a.person_id
ORDER BY
  LEAST(a.person_id, a.contact_person_id),
  GREATEST(a.person_id, a.contact_person_id),
  a.date_start;
